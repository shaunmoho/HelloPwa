<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hello PWA (Local Counter)</title>

    <link rel="manifest" href="./manifest.webmanifest" />
    <meta name="theme-color" content="#111827" />

    <link rel="icon" href="./icons/icon.svg" type="image/svg+xml" />

    <style>
      :root {
        --bg: #0b1220;
        --card: #111827;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --btn: #2563eb;
        --btn2: #374151;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        background: radial-gradient(1200px 600px at 20% 0%, #1f2937 0%, var(--bg) 60%);
        color: var(--text);
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .card {
        width: min(640px, 100%);
        background: color-mix(in oklab, var(--card) 92%, black);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      }

      h1 {
        margin: 0 0 8px;
        font-size: 28px;
      }

      .sub {
        margin: 0 0 18px;
        color: var(--muted);
        line-height: 1.4;
      }

      .counter {
        border-top: 1px solid rgba(255,255,255,0.08);
        padding-top: 16px;
      }

      .value {
        font-size: 20px;
        margin-bottom: 14px;
      }

      .buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }

      button {
        appearance: none;
        border: 0;
        border-radius: 10px;
        padding: 10px 14px;
        color: white;
        background: var(--btn);
        font-weight: 600;
        cursor: pointer;
      }

      button.secondary {
        background: var(--btn2);
      }

      button:active {
        transform: translateY(1px);
      }

      .hint {
        margin: 10px 0 0;
        color: var(--muted);
        font-size: 14px;
      }

      .footer {
        margin-top: 18px;
        color: var(--muted);
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    <main class="card">
      <h1>Hello World PWA</h1>
      <p class="sub">
        This counter persists locally (via <code>localStorage</code>) and the app supports basic offline caching.
      </p>

      <section class="counter">
        <div class="value" aria-live="polite">
          Counter: <span id="count">0</span>
        </div>

        <div class="buttons">
          <button id="inc" type="button">Increment</button>
          <button id="reset" type="button" class="secondary">Reset</button>
        </div>

        <p class="hint">
          Refresh the page (or close/reopen the installed app). The value should remain.
        </p>
      </section>

      <footer class="footer">
        <span id="swStatus">Service Worker: not registered</span>
      </footer>
    </main>

    <script>
      const STORAGE_KEY = "hello-pwa-counter";

      function getCount() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const n = Number(raw);
        return Number.isFinite(n) ? n : 0;
      }

      function setCount(n) {
        localStorage.setItem(STORAGE_KEY, String(n));
      }

      function render(n) {
        document.getElementById("count").textContent = String(n);
      }

      function setSwStatus(msg) {
        document.getElementById("swStatus").textContent = msg;
      }

      document.addEventListener("DOMContentLoaded", async () => {
        // Counter logic
        let count = getCount();
        render(count);

        document.getElementById("inc").addEventListener("click", () => {
          count += 1;
          setCount(count);
          render(count);
        });

        document.getElementById("reset").addEventListener("click", () => {
          count = 0;
          setCount(count);
          render(count);
        });

        // Service worker registration (unchanged)
        if ("serviceWorker" in navigator) {
          try {
            const reg = await navigator.serviceWorker.register("./service-worker.js", { scope: "./" });
            setSwStatus(`Service Worker: registered (${reg.scope})`);
          } catch {
            setSwStatus("Service Worker: registration failed");
          }
        } else {
          setSwStatus("Service Worker: not supported");
        }
      });
    </script>
  </body>
</html>
